const { Router } = require("express");

console.log("ğŸš€ ğŸš€ ğŸš€ Loading company-analysis.js route - UPDATED");

const router = Router();

console.log("âœ… Company analysis router created successfully");

// Simple test function for now
async function analyzeCompanyWebsite(websiteUrl) {
    console.log("ğŸ” Analyzing company website:", websiteUrl);
    
    // Return mock data for testing with expanded A4-length content
    return {
        companyName: "×¦.×.×— ×”××¨××Ÿ ×‘×¢\"×",
        about: `×¦.×.×— ×”××¨××Ÿ ×‘×¢"× ×”×™× ×—×‘×¨×ª ×‘× ×™×” ×•×ª×©×ª×™×•×ª ××•×‘×™×œ×” ×‘×™×©×¨××œ, ×”× ×¡×—×¨×ª ×‘×‘×•×¨×¡×” ×œ× ×™×™×¨×•×ª ×¢×¨×š ×‘×ª×œ ××‘×™×‘. ×”×—×‘×¨×” × ×•×¡×“×” ×‘×©× ×ª 1997 ×•××ª××—×” ×‘×¤×™×ª×•×— ×•×‘×™×¦×•×¢ ×¤×¨×•×™×§×˜×™× ××’×•×•× ×™× ×‘×ª×—×•× ×”× ×“×œ"×Ÿ.

×”×—×‘×¨×” ××ª××—×” ×‘×¤×¨×•×™×§×˜×™× ×©×œ ×‘× ×™×™× ×™ ××’×•×¨×™×, ××‘× ×™ ×¦×™×‘×•×¨, ××¨×›×–×™ ××¡×—×¨ ×•×ª×©×ª×™×•×ª. ×‘×™×Ÿ ×”×¤×¨×•×™×§×˜×™× ×”×‘×•×œ×˜×™× ×©×œ ×”×—×‘×¨×” × ×™×ª×Ÿ ×œ×× ×•×ª ×‘× ×™×™× ×™ ××’×•×¨×™× ××•×“×¨× ×™×™× ×‘×¢×¨×™× ××¨×›×–×™×•×ª, ××¨×›×–×™ ×§× ×™×•×ª ×•××‘× ×™ ××©×¨×“×™×.

×”×—×‘×¨×” ××—×–×™×§×” ×‘×ª×§× ×™ ×‘×˜×™×—×•×ª ××ª×§×“××™× ×›×•×œ×œ ISO 45001 ×•×ª×¢×•×“×•×ª ×‘×˜×™×—×•×ª × ×•×¡×¤×•×ª. ×”×™× ××—×•×™×‘×ª ×œ×©××™×¨×” ×¢×œ ×¨××ª ×‘×˜×™×—×•×ª ×’×‘×•×”×” ×‘×›×œ ×”×¤×¨×•×™×§×˜×™× ×©×œ×” ×•××§×¤×™×“×” ×¢×œ ×¢××™×“×” ×‘×ª×§× ×™× ×”×‘×™× ×œ××•××™×™×.

×”×—×‘×¨×” ××ª××—×” ×’× ×‘×¤×¨×•×™×§×˜×™ ×”×ª×—×“×©×•×ª ×¢×™×¨×•× ×™×ª ×•×¤×™×ª×•×— × ×›×¡×™× ×× ×™×‘×™×. ×”×™× ××—×–×™×§×” × ×™×¡×™×•×Ÿ ×¨×‘ ×‘×¤×™×ª×•×— ×¤×¨×•×™×§×˜×™× ××•×¨×›×‘×™× ×”×›×•×œ×œ×™× ×©×™×ª×•×£ ×¤×¢×•×œ×” ×¢× ×¨×©×•×™×•×ª ××§×•××™×•×ª ×•×§×‘×œ×ª ××™×©×•×¨×™× × ×“×¨×©×™×.

×”×—×‘×¨×” ××—×–×™×§×” ×¦×•×•×ª ××§×¦×•×¢×™ ×•××™×•××Ÿ ×”×›×•×œ×œ ××”× ×“×¡×™×, ××“×¨×™×›×œ×™× ×•××•××—×™× ×‘×ª×—×•× ×”×‘× ×™×”. ×”×™× ××©×§×™×¢×” ×‘×˜×›× ×•×œ×•×’×™×•×ª ××ª×§×“××•×ª ×•×‘×©×™×˜×•×ª ×¢×‘×•×“×” ×—×“×©× ×™×•×ª ×›×“×™ ×œ×”×‘×˜×™×— ××™×›×•×ª ×’×‘×•×”×” ×•×¢××™×“×” ×‘×œ×•×—×•×ª ×–×× ×™×.

×”×—×‘×¨×” ××—×•×™×‘×ª ×œ×§×™×™××•×ª ×•×œ×©××™×¨×” ×¢×œ ×”×¡×‘×™×‘×”. ×”×™× ××§×¤×™×“×” ×¢×œ ×©×™××•×© ×‘×—×•××¨×™× ×™×“×™×“×•×ª×™×™× ×œ×¡×‘×™×‘×” ×•×¢×œ ×™×™×©×•× ×©×™×˜×•×ª ×‘× ×™×” ×—×›××•×ª ×”××¤×—×™×ª×•×ª ××ª ×”×©×¤×¢×ª ×”×¤×¨×•×™×§×˜×™× ×¢×œ ×”×¡×‘×™×‘×”.

×”×—×‘×¨×” ××—×–×™×§×” ××¢×¨×›×ª × ×™×”×•×œ ××™×›×•×ª ××ª×§×“××ª ×•××§×¤×™×“×” ×¢×œ ×‘×§×¨×ª ××™×›×•×ª ×§×¤×“× ×™×ª ×‘×›×œ ×©×œ×‘×™ ×”×¤×¨×•×™×§×˜. ×”×™× ×¢×•×‘×“×ª ×¢× ×¡×¤×§×™× ××•×‘×™×œ×™× ×•××‘×¦×¢×ª ×‘×“×™×§×•×ª ××™×›×•×ª ××§×™×¤×•×ª ×œ×›×œ ×”×—×•××¨×™× ×•×”×©×™×¨×•×ª×™×.

×”×—×‘×¨×” ××—×–×™×§×” × ×™×¡×™×•×Ÿ ×¨×‘ ×‘×¢×‘×•×“×” ×¢× ×œ×§×•×—×•×ª ×¤×¨×˜×™×™× ×•×¦×™×‘×•×¨×™×™× ×›××—×“. ×”×™× ××ª××—×” ×‘×¤×¨×•×™×§×˜×™ "××¤×ª×— ×‘×™×“" ×”×›×•×œ×œ×™× ×ª×›× ×•×Ÿ, ×‘×™×¦×•×¢ ×•××¡×™×¨×” ××•×›× ×” ×œ×©×™××•×©.

×”×—×‘×¨×” ××—×–×™×§×” ××¢×¨×›×ª × ×™×”×•×œ ×¤×¨×•×™×§×˜×™× ××ª×§×“××ª ×”×××¤×©×¨×ª ××¢×§×‘ ××“×•×™×§ ××—×¨ ×”×ª×§×“××•×ª ×”×¤×¨×•×™×§×˜×™× ×•×¢××™×“×” ×‘×œ×•×—×•×ª ×–×× ×™×. ×”×™× ××©×ª××©×ª ×‘×˜×›× ×•×œ×•×’×™×•×ª ××ª×§×“××•×ª ×œ× ×™×”×•×œ ×¤×¨×•×™×§×˜×™× ×›×•×œ×œ ×ª×•×›× ×•×ª BIM ×•×›×œ×™ × ×™×”×•×œ ×“×™×’×™×˜×œ×™×™×.

×”×—×‘×¨×” ××—×•×™×‘×ª ×œ×—×“×©× ×•×ª ×•×œ×¤×™×ª×•×— ××ª××™×“ ×©×œ ×™×›×•×œ×•×ª×™×”. ×”×™× ××©×§×™×¢×” ×‘××—×§×¨ ×•×¤×™×ª×•×— ×©×œ ×©×™×˜×•×ª ×‘× ×™×” ×—×“×©× ×™×•×ª ×•×—×•××¨×™× ××ª×§×“××™×.

×”×—×‘×¨×” ××—×–×™×§×” ××¢×¨×›×ª × ×™×”×•×œ ×¡×™×›×•× ×™× ××§×™×¤×” ×•××§×¤×™×“×” ×¢×œ ×–×™×”×•×™ ×•×˜×™×¤×•×œ ×‘×¡×™×›×•× ×™× ×¤×•×˜× ×¦×™××œ×™×™× ×‘×›×œ ×”×¤×¨×•×™×§×˜×™× ×©×œ×”. ×”×™× ×¢×•×‘×“×ª ×¢× ×—×‘×¨×•×ª ×‘×™×˜×•×— ××•×‘×™×œ×•×ª ×›×“×™ ×œ×”×‘×˜×™×— ×›×™×¡×•×™ ×‘×™×˜×•×—×™ ××§×™×£.

×”×—×‘×¨×” ××—×•×™×‘×ª ×œ×©×§×™×¤×•×ª ×•×œ××ª×Ÿ ×“×™×•×•×—×™× ××¤×•×¨×˜×™× ×œ×œ×§×•×—×•×ª×™×”. ×”×™× ××¡×¤×§×ª ×¢×“×›×•× ×™× ×©×•×˜×¤×™× ×¢×œ ×”×ª×§×“××•×ª ×”×¤×¨×•×™×§×˜×™× ×•××§×¤×™×“×” ×¢×œ ×ª×§×©×•×¨×ª ×¤×ª×•×—×” ×•×‘×¨×•×¨×” ×¢× ×›×œ ×”×©×•×ª×¤×™×.

×”×—×‘×¨×” ××—×–×™×§×” ××¢×¨×›×ª × ×™×”×•×œ ××©××‘×™ ×× ×•×© ××ª×§×“××ª ×•××§×¤×™×“×” ×¢×œ ×¤×™×ª×•×— ××§×¦×•×¢×™ ×©×œ ×¢×•×‘×“×™×”. ×”×™× ××¡×¤×§×ª ×”×›×©×¨×•×ª ××ª××©×›×•×ª ×•××¢×•×“×“×ª ×—×“×©× ×•×ª ×•×™×¦×™×¨×ª×™×•×ª ×‘×§×¨×‘ ×¢×•×‘×“×™×”.

×”×—×‘×¨×” ××—×•×™×‘×ª ×œ×§×”×™×œ×” ×•×œ×¤×™×ª×•×— ××§×•××™. ×”×™× ××©×ª×ª×¤×ª ×‘×¤×¨×•×™×§×˜×™× ×§×”×™×œ×ª×™×™× ×•×ª×•××›×ª ×‘××¨×’×•× ×™× ××§×•××™×™×. ×”×™× ×¨×•××” ×¢×¦××” ×›×—×œ×§ ××”×§×”×™×œ×” ×•××—×•×™×‘×ª ×œ×ª×¨×•× ×œ×”×ª×¤×ª×—×•×ª×”.

×”×—×‘×¨×” ××—×–×™×§×” ××¢×¨×›×ª × ×™×”×•×œ ××™×›×•×ª ×¡×‘×™×‘×” ××ª×§×“××ª ×•××§×¤×™×“×” ×¢×œ ×©××™×¨×” ×¢×œ ×”×¡×‘×™×‘×” ×‘×›×œ ×”×¤×¢×™×œ×•×™×•×ª ×©×œ×”. ×”×™× ××©×ª××©×ª ×‘×˜×›× ×•×œ×•×’×™×•×ª ×™×¨×•×§×•×ª ×•××¢×•×“×“×ª ×©×™××•×© ×‘×× ×¨×’×™×” ××ª×—×“×©×ª.

×”×—×‘×¨×” ××—×•×™×‘×ª ×œ××¦×•×™× ×•×ª ×•×œ××ª×Ÿ ×©×™×¨×•×ª ×‘×¨××” ×”×’×‘×•×”×” ×‘×™×•×ª×¨. ×”×™× ××§×¤×™×“×” ×¢×œ ×¢××™×“×” ×‘×”×ª×—×™×™×‘×•×™×•×ª×™×” ×•××¡×¤×§×ª ×©×™×¨×•×ª ×œ×§×•×—×•×ª ××¢×•×œ×”. ×”×™× ×¨×•××” ××ª ×©×‘×™×¢×•×ª ×¨×¦×•×Ÿ ×”×œ×§×•×—×•×ª ×›××“×“ ×”×¦×œ×—×” ××¨×›×–×™.

×”×—×‘×¨×” ××—×–×™×§×” ××¢×¨×›×ª × ×™×”×•×œ ×™×“×¢ ××ª×§×“××ª ×•××§×¤×™×“×” ×¢×œ ×ª×™×¢×•×“ ×•×©×™×ª×•×£ ×™×“×¢ ×‘×™×Ÿ ×”×¤×¨×•×™×§×˜×™× ×”×©×•× ×™×. ×”×™× ×œ×•××“×ª ××›×œ ×¤×¨×•×™×§×˜ ×•××©×ª××©×ª ×‘×™×“×¢ ×©× ×¦×‘×¨ ×›×“×™ ×œ×©×¤×¨ ××ª ×”×‘×™×¦×•×¢×™× ×‘×¤×¨×•×™×§×˜×™× ×¢×ª×™×“×™×™×.

×”×—×‘×¨×” ××—×•×™×‘×ª ×œ×¤×™×ª×•×— ×‘×¨-×§×™×™×× ×•×¨×•××” ×‘×›×š ×—×œ×§ ××”××—×¨×™×•×ª ×”×—×‘×¨×ª×™×ª ×©×œ×”. ×”×™× ××§×¤×™×“×” ×¢×œ ×©×™××•×© ×‘×—×•××¨×™× ××§×•××™×™× ×•×¢×œ ×ª××™×›×” ×‘×¡×¤×§×™× ××§×•××™×™×.

×”×—×‘×¨×” ××—×–×™×§×” ××¢×¨×›×ª × ×™×”×•×œ ××™×›×•×ª ××ª×§×“××ª ×•××§×¤×™×“×” ×¢×œ ×‘×§×¨×ª ××™×›×•×ª ×§×¤×“× ×™×ª ×‘×›×œ ×©×œ×‘×™ ×”×¤×¨×•×™×§×˜. ×”×™× ×¢×•×‘×“×ª ×¢× ×¡×¤×§×™× ××•×‘×™×œ×™× ×•××‘×¦×¢×ª ×‘×“×™×§×•×ª ××™×›×•×ª ××§×™×¤×•×ª ×œ×›×œ ×”×—×•××¨×™× ×•×”×©×™×¨×•×ª×™×.

×”×—×‘×¨×” ××—×•×™×‘×ª ×œ×—×“×©× ×•×ª ×•×œ×¤×™×ª×•×— ××ª××™×“ ×©×œ ×™×›×•×œ×•×ª×™×”. ×”×™× ××©×§×™×¢×” ×‘××—×§×¨ ×•×¤×™×ª×•×— ×©×œ ×©×™×˜×•×ª ×‘× ×™×” ×—×“×©× ×™×•×ª ×•×—×•××¨×™× ××ª×§×“××™×.

×”×—×‘×¨×” ××—×–×™×§×” ××¢×¨×›×ª × ×™×”×•×œ ×¡×™×›×•× ×™× ××§×™×¤×” ×•××§×¤×™×“×” ×¢×œ ×–×™×”×•×™ ×•×˜×™×¤×•×œ ×‘×¡×™×›×•× ×™× ×¤×•×˜× ×¦×™××œ×™×™× ×‘×›×œ ×”×¤×¨×•×™×§×˜×™× ×©×œ×”. ×”×™× ×¢×•×‘×“×ª ×¢× ×—×‘×¨×•×ª ×‘×™×˜×•×— ××•×‘×™×œ×•×ª ×›×“×™ ×œ×”×‘×˜×™×— ×›×™×¡×•×™ ×‘×™×˜×•×—×™ ××§×™×£.

×”×—×‘×¨×” ××—×•×™×‘×ª ×œ×©×§×™×¤×•×ª ×•×œ××ª×Ÿ ×“×™×•×•×—×™× ××¤×•×¨×˜×™× ×œ×œ×§×•×—×•×ª×™×”. ×”×™× ××¡×¤×§×ª ×¢×“×›×•× ×™× ×©×•×˜×¤×™× ×¢×œ ×”×ª×§×“××•×ª ×”×¤×¨×•×™×§×˜×™× ×•××§×¤×™×“×” ×¢×œ ×ª×§×©×•×¨×ª ×¤×ª×•×—×” ×•×‘×¨×•×¨×” ×¢× ×›×œ ×”×©×•×ª×¤×™×.

×”×—×‘×¨×” ××—×–×™×§×” ××¢×¨×›×ª × ×™×”×•×œ ××©××‘×™ ×× ×•×© ××ª×§×“××ª ×•××§×¤×™×“×” ×¢×œ ×¤×™×ª×•×— ××§×¦×•×¢×™ ×©×œ ×¢×•×‘×“×™×”. ×”×™× ××¡×¤×§×ª ×”×›×©×¨×•×ª ××ª××©×›×•×ª ×•××¢×•×“×“×ª ×—×“×©× ×•×ª ×•×™×¦×™×¨×ª×™×•×ª ×‘×§×¨×‘ ×¢×•×‘×“×™×”.

×”×—×‘×¨×” ××—×•×™×‘×ª ×œ×§×”×™×œ×” ×•×œ×¤×™×ª×•×— ××§×•××™. ×”×™× ××©×ª×ª×¤×ª ×‘×¤×¨×•×™×§×˜×™× ×§×”×™×œ×ª×™×™× ×•×ª×•××›×ª ×‘××¨×’×•× ×™× ××§×•××™×™×. ×”×™× ×¨×•××” ×¢×¦××” ×›×—×œ×§ ××”×§×”×™×œ×” ×•××—×•×™×‘×ª ×œ×ª×¨×•× ×œ×”×ª×¤×ª×—×•×ª×”.

×”×—×‘×¨×” ××—×–×™×§×” ××¢×¨×›×ª × ×™×”×•×œ ××™×›×•×ª ×¡×‘×™×‘×” ××ª×§×“××ª ×•××§×¤×™×“×” ×¢×œ ×©××™×¨×” ×¢×œ ×”×¡×‘×™×‘×” ×‘×›×œ ×”×¤×¢×™×œ×•×™×•×ª ×©×œ×”. ×”×™× ××©×ª××©×ª ×‘×˜×›× ×•×œ×•×’×™×•×ª ×™×¨×•×§×•×ª ×•××¢×•×“×“×ª ×©×™××•×© ×‘×× ×¨×’×™×” ××ª×—×“×©×ª.

×”×—×‘×¨×” ××—×•×™×‘×ª ×œ××¦×•×™× ×•×ª ×•×œ××ª×Ÿ ×©×™×¨×•×ª ×‘×¨××” ×”×’×‘×•×”×” ×‘×™×•×ª×¨. ×”×™× ××§×¤×™×“×” ×¢×œ ×¢××™×“×” ×‘×”×ª×—×™×™×‘×•×™×•×ª×™×” ×•××¡×¤×§×ª ×©×™×¨×•×ª ×œ×§×•×—×•×ª ××¢×•×œ×”. ×”×™× ×¨×•××” ××ª ×©×‘×™×¢×•×ª ×¨×¦×•×Ÿ ×”×œ×§×•×—×•×ª ×›××“×“ ×”×¦×œ×—×” ××¨×›×–×™.`,
        safety: "×”×—×‘×¨×” ××—×–×™×§×” ×‘×ª×§× ×™ ×‘×˜×™×—×•×ª ××ª×§×“××™× ×›×•×œ×œ ISO 45001 ×•×ª×¢×•×“×•×ª ×‘×˜×™×—×•×ª × ×•×¡×¤×•×ª. ×”×™× ××—×•×™×‘×ª ×œ×©××™×¨×” ×¢×œ ×¨××ª ×‘×˜×™×—×•×ª ×’×‘×•×”×” ×‘×›×œ ×”×¤×¨×•×™×§×˜×™× ×©×œ×” ×•××§×¤×™×“×” ×¢×œ ×¢××™×“×” ×‘×ª×§× ×™× ×”×‘×™× ×œ××•××™×™×.",
        projects: "×‘×™×Ÿ ×”×¤×¨×•×™×§×˜×™× ×”×‘×•×œ×˜×™×: ×‘× ×™×™× ×™ ××’×•×¨×™× ×‘×ª×œ ××‘×™×‘, ××¨×›×–×™ ×§× ×™×•×ª ×•××‘× ×™ ×¦×™×‘×•×¨. ×”×—×‘×¨×” ××ª××—×” ×’× ×‘×¤×¨×•×™×§×˜×™ ×”×ª×—×“×©×•×ª ×¢×™×¨×•× ×™×ª ×•×¤×™×ª×•×— × ×›×¡×™× ×× ×™×‘×™×.",
        logoUrl: "/assets/logo.svg"
    };
}

/**
 * POST /analyze-company - Analyze company website
 */
router.post("/analyze-company", async (req, res) => {
    console.log("ğŸ¯ ğŸ¯ ğŸ¯ POST /analyze-company route hit - UPDATED");
    try {
        const { website } = req.body;

        if (!website) {
            return res.status(400).json({
                success: false,
                error: "Website URL is required"
            });
        }

        console.log("ğŸŒ Analyzing company website:", website);

        const analysisResult = await analyzeCompanyWebsite(website);

        res.json({
            success: true,
            data: analysisResult
        });

    } catch (error) {
        console.error("âŒ Error in company analysis:", error);
        res.status(500).json({
            success: false,
            error: error.message || "Failed to analyze company website"
        });
    }
});

module.exports = router;
